<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Billing System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #343a40;
            transition: all 0.3s;
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.75);
            border-radius: 5px;
            margin-bottom: 5px;
        }
        .sidebar .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .sidebar .nav-link.active {
            color: white;
            background-color: #007bff;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .category-btn {
            margin: 5px;
            white-space: nowrap;
        }
        .menu-item-card {
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
        }
        .menu-item-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .order-item {
            border-bottom: 1px solid #eee;
            padding: 8px 0;
        }
        .bill-print {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ddd;
            max-width: 500px;
            margin: 0 auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .table-status {
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
            position: relative;
        }
        .table-status.available {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .table-status.occupied {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .table-status.reserved {
            background-color: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        .table-status:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .kitchen-order-card {
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .kitchen-order-card.pending {
            border-left: 5px solid #ffc107;
        }
        .kitchen-order-card.preparing {
            border-left: 5px solid #fd7e14;
        }
        .kitchen-order-card.ready {
            border-left: 5px solid #28a745;
        }
        .kitchen-order-card.completed {
            border-left: 5px solid #6c757d;
        }
        .order-status-badge {
            cursor: pointer;
        }
        .table-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7rem;
        }
        .order-type-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.7rem;
        }
        .kitchen-timer {
            font-size: 0.8rem;
            color: #6c757d;
        }
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .order-actions {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        .confirm-order-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
            transition: all 0.3s;
        }
        .confirm-order-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.4);
        }
        .print-section {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 80mm;
            background: white;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
            }
            .bill-print {
                max-width: 100%;
                margin: 0;
                padding: 10px;
                font-size: 11px;
                line-height: 1.3;
            }
            .no-print {
                display: none !important;
            }
            @page {
                size: 80mm auto;
                margin: 5mm;
            }
        }
        @media (max-width: 768px) {
            .table-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .sidebar {
                min-height: auto;
                width: 100%;
            }
        }
        .order-confirmation-modal .modal-dialog {
            max-width: 600px;
        }
        .order-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .table-selection-highlight {
            background-color: #007bff !important;
            color: white !important;
            border-color: #0056b3 !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Navigation -->
            <div class="col-md-2 sidebar p-3">
                <h4 class="text-center mb-4 text-white">Restaurant POS</h4>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="tables">
                            <i class="fas fa-table me-2"></i>Table Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="orders">
                            <i class="fas fa-utensils me-2"></i>New Order
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="kitchen">
                            <i class="fas fa-utensils me-2"></i>Kitchen View
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="menu">
                            <i class="fas fa-list me-2"></i>Menu Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="reports">
                            <i class="fas fa-chart-bar me-2"></i>Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="settings">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-10 p-4">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section active">
                    <h3><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h3>
                    <hr>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">Today's Orders</h5>
                                    <h2 class="card-text" id="today-orders">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">Today's Revenue</h5>
                                    <h2 class="card-text" id="today-revenue">₹0.00</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">Active Tables</h5>
                                    <h2 class="card-text" id="active-tables">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">Kitchen Orders</h5>
                                    <h2 class="card-text" id="kitchen-orders">0</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Recent Orders</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Order #</th>
                                                <th>Table</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recent-orders">
                                            <!-- Filled by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Popular Items</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Item</th>
                                                <th>Qty Sold</th>
                                                <th>Revenue</th>
                                            </tr>
                                        </thead>
                                        <tbody id="popular-items">
                                            <!-- Filled by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table Management Section -->
                <div id="tables" class="content-section">
                    <h3><i class="fas fa-table me-2"></i>Table Management</h3>
                    <hr>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Table Status - Click to Select Table for New Order</h5>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary me-2" id="toggle-view">
                                            <i class="fas fa-th-large"></i> Grid View
                                        </button>
                                        <button class="btn btn-sm btn-primary" id="refresh-tables">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>Green:</strong> Available | <strong>Red:</strong> Occupied | <strong>Yellow:</strong> Reserved
                                        <br>Click on an available table to start a new order for that table.
                                    </div>
                                    <div class="table-grid" id="table-status-grid">
                                        <!-- Tables will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTableModal">
                                            <i class="fas fa-plus me-1"></i> Add New Table
                                        </button>
                                        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#removeTableModal">
                                            <i class="fas fa-minus me-1"></i> Remove Table
                                        </button>
                                        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#reserveTableModal">
                                            <i class="fas fa-calendar-alt me-1"></i> Reserve Table
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card mt-4">
                                <div class="card-header">
                                    <h5>Active Orders</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush" id="active-orders-list">
                                        <!-- Active orders will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Order Section -->
                <div id="orders" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-utensils me-2"></i>New Order</h3>
                        <div>
                            <button class="btn btn-primary me-2" id="print-kitchen-order">
                                <i class="fas fa-print me-1"></i> Print Kitchen Order
                            </button>
                            <button class="btn btn-success confirm-order-btn" id="confirm-order">
                                <i class="fas fa-check me-1"></i> Confirm Order
                            </button>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Menu Categories</h5>
                                        <div class="input-group" style="width: 200px;">
                                            <input type="text" class="form-control form-control-sm" id="menu-search" placeholder="Search menu...">
                                            <button class="btn btn-sm btn-outline-secondary" id="clear-search">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="categories" class="d-flex flex-wrap">
                                        <!-- Categories will be loaded here -->
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h5>Menu Items</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row" id="menu-items">
                                        <!-- Menu items will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Current Order</h5>
                                    <span class="badge bg-primary">Table: <span id="current-table-number">Select Table</span></span>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="order-type" class="form-label">Order Type</label>
                                        <select class="form-select" id="order-type">
                                            <option value="dine-in">Dine-In</option>
                                            <option value="takeaway">Takeaway</option>
                                            <option value="delivery">Delivery</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="table-number" class="form-label">Table Number</label>
                                        <select class="form-select" id="table-number">
                                            <!-- Tables will be loaded here -->
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="customer-name" class="form-label">Customer Name</label>
                                        <input type="text" class="form-control" id="customer-name" placeholder="Enter customer name">
                                    </div>
                                    <div class="mb-3">
                                        <label for="customer-phone" class="form-label">Customer Phone</label>
                                        <input type="tel" class="form-control" id="customer-phone" placeholder="Enter phone number">
                                    </div>
                                    <hr>
                                    <div id="order-items">
                                        <!-- Order items will be displayed here -->
                                        <p class="text-muted text-center">No items added yet</p>
                                    </div>
                                    <hr>
                                    <div class="mb-3">
                                        <label for="order-notes" class="form-label">Order Notes</label>
                                        <textarea class="form-control" id="order-notes" rows="2" placeholder="Special instructions..."></textarea>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Subtotal:</span>
                                        <span id="order-subtotal">₹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Tax (<span id="tax-rate-display">5</span>%):</span>
                                        <span id="order-tax">₹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Service Charge (<span id="service-charge-display">10</span>%):</span>
                                        <span id="order-service">₹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <h5>Total:</h5>
                                        <h5 id="order-total">₹0.00</h5>
                                    </div>
                                    <div class="d-grid gap-2 mt-3">
                                        <button class="btn btn-danger" id="clear-order">
                                            <i class="fas fa-trash me-1"></i> Clear Order
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kitchen View Section -->
                <div id="kitchen" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-utensils me-2"></i>Kitchen Orders</h3>
                        <div>
                            <button class="btn btn-outline-secondary me-2" id="kitchen-settings">
                                <i class="fas fa-cog"></i> Settings
                            </button>
                            <button class="btn btn-primary" id="refresh-kitchen">
                                <i class="fas fa-sync-alt me-1"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <ul class="nav nav-tabs card-header-tabs" id="kitchen-tabs">
                                        <li class="nav-item">
                                            <a class="nav-link active" data-bs-toggle="tab" href="#pending-orders">Pending</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#preparing-orders">Preparing</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#ready-orders">Ready</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#completed-orders">Completed</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" data-bs-toggle="tab" href="#all-orders">All Orders</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-body">
                                    <div class="tab-content" id="kitchen-tab-content">
                                        <div class="tab-pane fade show active" id="pending-orders">
                                            <div class="row" id="pending-orders-container">
                                                <!-- Pending orders will be loaded here -->
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="preparing-orders">
                                            <div class="row" id="preparing-orders-container">
                                                <!-- Preparing orders will be loaded here -->
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="ready-orders">
                                            <div class="row" id="ready-orders-container">
                                                <!-- Ready orders will be loaded here -->
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="completed-orders">
                                            <div class="row" id="completed-orders-container">
                                                <!-- Completed orders will be loaded here -->
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="all-orders">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Order #</th>
                                                            <th>Table</th>
                                                            <th>Items</th>
                                                            <th>Time</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="all-kitchen-orders">
                                                        <!-- All kitchen orders will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu Management Section -->
                <div id="menu" class="content-section">
                    <h3><i class="fas fa-list me-2"></i>Menu Management</h3>
                    <hr>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Add New Category</h5>
                                </div>
                                <div class="card-body">
                                    <form id="add-category-form">
                                        <div class="mb-3">
                                            <label for="category-name" class="form-label">Category Name</label>
                                            <input type="text" class="form-control" id="category-name" required>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Category</button>
                                    </form>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h5>Add New Item</h5>
                                </div>
                                <div class="card-body">
                                    <form id="add-item-form">
                                        <div class="mb-3">
                                            <label for="item-category" class="form-label">Category</label>
                                            <select class="form-select" id="item-category" required>
                                                <!-- Categories will be loaded here -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="item-name" class="form-label">Item Name</label>
                                            <input type="text" class="form-control" id="item-name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="item-price" class="form-label">Price</label>
                                            <input type="number" step="0.01" class="form-control" id="item-price" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="item-description" class="form-label">Description</label>
                                            <textarea class="form-control" id="item-description" rows="2"></textarea>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="item-availability" checked>
                                            <label class="form-check-label" for="item-availability">Available</label>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Add Item</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Current Menu</h5>
                                        <button class="btn btn-sm btn-outline-primary" id="export-menu">
                                            <i class="fas fa-file-export me-1"></i> Export Menu
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="menu-categories-accordion" class="accordion">
                                        <!-- Menu items by category will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports" class="content-section">
                    <h3><i class="fas fa-chart-bar me-2"></i>Reports</h3>
                    <hr>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Sales Report</h5>
                                </div>
                                <div class="card-body">
                                    <form id="sales-report-form">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="report-start-date" class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="report-start-date" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="report-end-date" class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="report-end-date" required>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="report-type" class="form-label">Report Type</label>
                                            <select class="form-select" id="report-type">
                                                <option value="summary">Summary Report</option>
                                                <option value="detailed">Detailed Report</option>
                                                <option value="category">Category-wise</option>
                                                <option value="hourly">Hourly Sales</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Generate Report</button>
                                        <button type="button" class="btn btn-success ms-2" id="export-report">
                                            <i class="fas fa-file-excel me-1"></i> Export to Excel
                                        </button>
                                    </form>
                                    <div id="sales-report-results" class="mt-3">
                                        <!-- Report results will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Print Bill</h5>
                                </div>
                                <div class="card-body">
                                    <form id="print-bill-form">
                                        <div class="mb-3">
                                            <label for="bill-order-id" class="form-label">Order ID</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="bill-order-id" required>
                                                <button class="btn btn-outline-secondary" type="button" id="find-order">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-primary" id="print-kitchen-bill">
                                                <i class="fas fa-print me-1"></i> Kitchen Bill
                                            </button>
                                            <button type="button" class="btn btn-secondary" id="print-customer-bill">
                                                <i class="fas fa-print me-1"></i> Customer Bill
                                            </button>
                                            <button type="button" class="btn btn-info" id="print-admin-bill">
                                                <i class="fas fa-print me-1"></i> Admin Bill
                                            </button>
                                        </div>
                                    </form>
                                    <div class="mt-3" id="order-preview">
                                        <!-- Order preview will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Recent Orders</h5>
                                <div class="input-group" style="width: 250px;">
                                    <input type="text" class="form-control form-control-sm" id="order-search" placeholder="Search orders...">
                                    <button class="btn btn-sm btn-outline-secondary" id="clear-order-search">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Table</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="all-orders-table">
                                    <!-- All orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="content-section">
                    <h3><i class="fas fa-cog me-2"></i>Settings</h3>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Restaurant Information</h5>
                                </div>
                                <div class="card-body">
                                    <form id="restaurant-info-form">
                                        <div class="mb-3">
                                            <label for="restaurant-name" class="form-label">Restaurant Name</label>
                                            <input type="text" class="form-control" id="restaurant-name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="restaurant-address" class="form-label">Address</label>
                                            <textarea class="form-control" id="restaurant-address" rows="3" required></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="restaurant-phone" class="form-label">Phone Number</label>
                                            <input type="tel" class="form-control" id="restaurant-phone" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="restaurant-gst" class="form-label">GST Number</label>
                                            <input type="text" class="form-control" id="restaurant-gst">
                                        </div>
                                        <div class="mb-3">
                                            <label for="restaurant-logo" class="form-label">Restaurant Logo</label>
                                            <input type="file" class="form-control" id="restaurant-logo" accept="image/*">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Information</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>System Settings</h5>
                                </div>
                                <div class="card-body">
                                    <form id="system-settings-form">
                                        <div class="mb-3">
                                            <label for="tax-rate" class="form-label">Tax Rate (%)</label>
                                            <input type="number" step="0.01" class="form-control" id="tax-rate" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="service-charge" class="form-label">Service Charge (%)</label>
                                            <input type="number" step="0.01" class="form-control" id="service-charge" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="currency-symbol" class="form-label">Currency Symbol</label>
                                            <input type="text" class="form-control" id="currency-symbol" required>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="enable-discount">
                                            <label class="form-check-label" for="enable-discount">Enable Discount Option</label>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="auto-print-kitchen">
                                            <label class="form-check-label" for="auto-print-kitchen">Auto-print Kitchen Orders</label>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="enable-kds">
                                            <label class="form-check-label" for="enable-kds">Enable Kitchen Display System</label>
                                        </div>
                                        <div class="mb-3">
                                            <label for="kds-refresh-rate" class="form-label">KDS Refresh Rate (seconds)</label>
                                            <input type="number" class="form-control" id="kds-refresh-rate" min="5" value="10">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                    <hr>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-danger" id="reset-data">
                                            <i class="fas fa-trash me-1"></i> Reset All Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div class="modal fade order-confirmation-modal" id="orderConfirmationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle me-2"></i>Confirm Order
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong>Table:</strong> <span id="confirm-table">-</span>
                        </div>
                        <div class="col-6">
                            <strong>Order Type:</strong> <span id="confirm-order-type">-</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong>Customer:</strong> <span id="confirm-customer">-</span>
                        </div>
                        <div class="col-6">
                            <strong>Phone:</strong> <span id="confirm-phone">-</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <strong>Special Notes:</strong> <span id="confirm-notes">None</span>
                    </div>
                    <hr>
                    <h6>Order Items:</h6>
                    <div id="confirm-items">
                        <!-- Items will be populated here -->
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-6">
                            <div class="d-flex justify-content-between">
                                <span>Subtotal:</span>
                                <span id="confirm-subtotal">₹0.00</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Tax:</span>
                                <span id="confirm-tax">₹0.00</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Service:</span>
                                <span id="confirm-service">₹0.00</span>
                            </div>
                        </div>
                        <div class="col-6 text-end">
                            <h5>Total: <span id="confirm-total">₹0.00</span></h5>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="final-confirm-order">
                        <i class="fas fa-utensils me-1"></i> Send to Kitchen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Table Modal -->
    <div class="modal fade" id="addTableModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Table</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="add-table-form">
                        <div class="mb-3">
                            <label for="new-table-number" class="form-label">Table Number</label>
                            <input type="number" class="form-control" id="new-table-number" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="table-capacity" class="form-label">Capacity</label>
                            <input type="number" class="form-control" id="table-capacity" min="1" value="4">
                        </div>
                        <div class="mb-3">
                            <label for="table-location" class="form-label">Location</label>
                            <select class="form-select" id="table-location">
                                <option value="main">Main Hall</option>
                                <option value="terrace">Terrace</option>
                                <option value="private">Private Room</option>
                                <option value="bar">Bar Area</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-add-table">Add Table</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Remove Table Modal -->
    <div class="modal fade" id="removeTableModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Remove Table</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="remove-table-form">
                        <div class="mb-3">
                            <label for="remove-table-number" class="form-label">Select Table to Remove</label>
                            <select class="form-select" id="remove-table-number" required>
                                <!-- Tables will be loaded here -->
                            </select>
                        </div>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Removing a table with active orders will cancel those orders.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-remove-table">Remove Table</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reserve Table Modal -->
    <div class="modal fade" id="reserveTableModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reserve Table</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reserve-table-form">
                        <div class="mb-3">
                            <label for="reserve-table-number" class="form-label">Table Number</label>
                            <select class="form-select" id="reserve-table-number" required>
                                <!-- Available tables will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="reservation-name" class="form-label">Customer Name</label>
                            <input type="text" class="form-control" id="reservation-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="reservation-phone" class="form-label">Customer Phone</label>
                            <input type="tel" class="form-control" id="reservation-phone" required>
                        </div>
                        <div class="mb-3">
                            <label for="reservation-time" class="form-label">Reservation Time</label>
                            <input type="datetime-local" class="form-control" id="reservation-time" required>
                        </div>
                        <div class="mb-3">
                            <label for="reservation-guests" class="form-label">Number of Guests</label>
                            <input type="number" class="form-control" id="reservation-guests" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="reservation-notes" class="form-label">Special Requests</label>
                            <textarea class="form-control" id="reservation-notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-reserve-table">Reserve Table</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Kitchen Settings Modal -->
    <div class="modal fade" id="kitchenSettingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Kitchen Display Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="kitchen-settings-form">
                        <div class="mb-3">
                            <label for="kitchen-name" class="form-label">Kitchen Station Name</label>
                            <input type="text" class="form-control" id="kitchen-name" value="Main Kitchen">
                        </div>
                        <div class="mb-3">
                            <label for="kitchen-printer" class="form-label">Printer IP Address</label>
                            <input type="text" class="form-control" id="kitchen-printer" placeholder="192.168.1.100">
                        </div>
                        <div class="mb-3">
                            <label for="kitchen-categories" class="form-label">Categories to Display</label>
                            <select class="form-select" id="kitchen-categories" multiple>
                                <!-- Categories will be loaded here -->
                            </select>
                            <small class="text-muted">Hold Ctrl/Cmd to select multiple categories</small>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="kitchen-sound" checked>
                            <label class="form-check-label" for="kitchen-sound">Enable Sound Notifications</label>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="kitchen-alerts" checked>
                            <label class="form-check-label" for="kitchen-alerts">Enable Visual Alerts</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-kitchen-settings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Section (Hidden) -->
    <div class="print-section">
        <div id="bill-print-content" class="bill-print">
            <!-- Bill content will be generated here -->
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-action-btn btn btn-primary no-print" id="quick-order-btn" onclick="switchToOrdersTab()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize data structure
        let restaurantData = {
            categories: [],
            menuItems: [],
            orders: [],
            tables: [],
            reservations: [],
            settings: {
                restaurantName: "My Restaurant",
                address: "123 Main St, City",
                phone: "9876543210",
                gst: "GST123456789",
                taxRate: 5,
                serviceCharge: 10,
                currencySymbol: "₹",
                enableDiscount: true,
                autoPrintKitchen: true,
                enableKDS: true,
                kdsRefreshRate: 10,
                kitchenSettings: {
                    name: "Main Kitchen",
                    printerIP: "",
                    categories: [],
                    soundEnabled: true,
                    alertsEnabled: true
                }
            }
        };

        // Current order
        let currentOrder = {
            items: [],
            tableNumber: null,
            customerName: "",
            customerPhone: "",
            orderType: "dine-in",
            notes: "",
            date: new Date(),
            status: "pending",
            kitchenStatus: "pending"
        };

        // Kitchen order statuses
        const KITCHEN_STATUS = {
            PENDING: 'pending',
            PREPARING: 'preparing',
            READY: 'ready',
            COMPLETED: 'completed'
        };

        // Order types
        const ORDER_TYPES = {
            DINE_IN: 'dine-in',
            TAKEAWAY: 'takeaway',
            DELIVERY: 'delivery'
        };

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('restaurantData');
            if (savedData) {
                restaurantData = JSON.parse(savedData);
            }
            
            updateUI();
            
            // Restore active section from localStorage
            const activeSection = localStorage.getItem('activeSection') || 'dashboard';
            document.querySelectorAll('.nav-link').forEach(navLink => {
                navLink.classList.remove('active');
                if (navLink.dataset.section === activeSection) {
                    navLink.classList.add('active');
                }
            });
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
                if (section.id === activeSection) {
                    section.classList.add('active');
                }
            });
            
            // Start checking for kitchen updates
            startKitchenUpdateChecker();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('restaurantData', JSON.stringify(restaurantData));
            updateUI();
        }

        // Update UI based on current data
        function updateUI() {
            updateDashboard();
            updateTables();
            updateActiveOrdersList();
            updateTableDropdowns();
            updateCategories();
            updateMenuItems();
            updateOrderItems();
            updateKitchenView();
            updateMenuManagement();
            updateAllOrdersTable();
            updateOrderPreview();
            updateSettingsForm();
        }

        // Switch to orders tab function
        function switchToOrdersTab() {
            document.querySelector('[data-section="orders"]').click();
        }

        // Table click handler
        function handleTableClick(tableNumber) {
            const table = restaurantData.tables.find(t => t.number === tableNumber);
            if (!table) return;

            if (table.status === 'available') {
                // Clear any previous table selection highlights
                document.querySelectorAll('.table-status').forEach(t => {
                    t.classList.remove('table-selection-highlight');
                });
                
                // Highlight selected table
                event.target.closest('.table-status').classList.add('table-selection-highlight');
                
                // Set current order table
                currentOrder.tableNumber = tableNumber;
                currentOrder.orderType = 'dine-in';
                
                // Update UI
                document.getElementById('table-number').value = tableNumber;
                document.getElementById('order-type').value = 'dine-in';
                document.getElementById('current-table-number').textContent = tableNumber;
                
                // Show success message
                showNotification(`Table ${tableNumber} selected for new order`, 'success');
                
                // Switch to orders tab after a short delay
                setTimeout(() => {
                    document.querySelector('[data-section="orders"]').click();
                }, 1000);
                
            } else if (table.status === 'occupied') {
                // View order details
                const order = restaurantData.orders.find(o => o.id === table.orderId);
                if (order) {
                    viewOrderDetails(order.id);
                }
            } else if (table.status === 'reserved') {
                // View reservation details
                const reservation = restaurantData.reservations.find(r => r.tableNumber === tableNumber);
                if (reservation) {
                    showNotification(`Table ${tableNumber} is reserved for ${reservation.customerName} at ${new Date(reservation.time).toLocaleString()}`, 'info');
                }
            }
        }

        // Show notification function
        function showNotification(message, type = 'info') {
            // Create a simple notification
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Kitchen view functions
        function updateKitchenView() {
            updateKitchenOrdersByStatus(KITCHEN_STATUS.PENDING, 'pending-orders-container');
            updateKitchenOrdersByStatus(KITCHEN_STATUS.PREPARING, 'preparing-orders-container');
            updateKitchenOrdersByStatus(KITCHEN_STATUS.READY, 'ready-orders-container');
            updateKitchenOrdersByStatus(KITCHEN_STATUS.COMPLETED, 'completed-orders-container');
            updateAllKitchenOrdersTable();
        }

        function updateKitchenOrdersByStatus(status, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const filteredOrders = restaurantData.orders.filter(order => 
                order.kitchenStatus === status && order.status !== 'completed'
            );
            
            if (filteredOrders.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center text-muted py-4">
                        <i class="fas fa-utensils fa-3x mb-3"></i>
                        <p>No ${status} orders</p>
                    </div>
                `;
                return;
            }
            
            filteredOrders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = `col-md-6 kitchen-order-card ${status}`;
                
                let itemsList = '';
                order.items.forEach(item => {
                    itemsList += `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>${item.quantity}x ${item.name}</span>
                            <span class="badge bg-secondary">${restaurantData.settings.currencySymbol}${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `;
                });
                
                // Calculate time since order was placed
                const orderTime = new Date(order.date);
                const now = new Date();
                const minutesElapsed = Math.floor((now - orderTime) / (1000 * 60));
                
                orderCard.innerHTML = `
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Order #${order.id}</h5>
                            <div>
                                <span class="badge bg-primary me-1">${order.orderType === 'dine-in' ? 'Table' : order.orderType === 'takeaway' ? 'Takeaway' : 'Delivery'} ${order.orderType === 'dine-in' ? order.tableNumber : ''}</span>
                                <span class="badge bg-dark">${minutesElapsed}m ago</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <p class="mb-1"><strong>Customer:</strong> ${order.customerName}</p>
                                <p class="mb-1"><strong>Time:</strong> ${orderTime.toLocaleTimeString()}</p>
                                ${order.notes ? `<p class="mb-1"><strong>Notes:</strong> ${order.notes}</p>` : ''}
                            </div>
                            <hr>
                            <div class="mb-3">
                                ${itemsList}
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge order-status-badge bg-${getStatusBadgeColor(order.kitchenStatus)}" 
                                      data-order-id="${order.id}">
                                    ${order.kitchenStatus.toUpperCase()}
                                </span>
                                <div class="order-actions">
                                    <button class="btn btn-sm btn-outline-primary print-kitchen-ticket" data-order-id="${order.id}">
                                        <i class="fas fa-print"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success complete-kitchen-order" data-order-id="${order.id}">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(orderCard);
            });
            
            // Add event listeners to status badges
            document.querySelectorAll('.order-status-badge').forEach(badge => {
                badge.addEventListener('click', (e) => {
                    const orderId = e.target.dataset.orderId;
                    updateKitchenOrderStatus(orderId);
                });
            });
            
            // Add event listeners to print buttons
            document.querySelectorAll('.print-kitchen-ticket').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.orderId;
                    printKitchenTicket(orderId);
                });
            });
            
            // Add event listeners to complete buttons
            document.querySelectorAll('.complete-kitchen-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.orderId;
                    completeKitchenOrder(orderId);
                });
            });
        }

        function updateAllKitchenOrdersTable() {
            const tableBody = document.getElementById('all-kitchen-orders');
            tableBody.innerHTML = '';
            
            const sortedOrders = [...restaurantData.orders].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedOrders.forEach(order => {
                const orderTime = new Date(order.date);
                const now = new Date();
                const minutesElapsed = Math.floor((now - orderTime) / (1000 * 60));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.orderType === 'dine-in' ? order.tableNumber : order.orderType}</td>
                    <td>${order.items.length} items</td>
                    <td>${orderTime.toLocaleTimeString()} (${minutesElapsed}m ago)</td>
                    <td>
                        <span class="badge bg-${getStatusBadgeColor(order.kitchenStatus)}">
                            ${order.kitchenStatus}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary view-kitchen-order" data-order-id="${order.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success complete-kitchen-order" data-order-id="${order.id}">
                            <i class="fas fa-check"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.view-kitchen-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.orderId;
                    viewKitchenOrderDetails(orderId);
                });
            });
            
            document.querySelectorAll('.complete-kitchen-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.orderId;
                    completeKitchenOrder(orderId);
                });
            });
        }

        function viewKitchenOrderDetails(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            const printContent = generatePrintContent(order, 'kitchen');
            document.getElementById('bill-print-content').innerHTML = printContent;
            
            // Show print dialog
            window.print();
        }

        function completeKitchenOrder(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            order.kitchenStatus = KITCHEN_STATUS.COMPLETED;
            
            // If all items are completed, mark order as completed
            if (order.kitchenStatus === KITCHEN_STATUS.COMPLETED && order.status === 'pending') {
                order.status = 'completed';
                
                // If dine-in, free up the table
                if (order.orderType === 'dine-in') {
                    updateTableStatus(order.tableNumber, 'available');
                }
            }
            
            saveData();
            showNotification(`Order ${orderId} marked as completed!`, 'success');
        }

        function getStatusBadgeColor(status) {
            switch(status) {
                case KITCHEN_STATUS.PENDING: return 'warning';
                case KITCHEN_STATUS.PREPARING: return 'info';
                case KITCHEN_STATUS.READY: return 'success';
                case KITCHEN_STATUS.COMPLETED: return 'secondary';
                default: return 'primary';
            }
        }

        function updateKitchenOrderStatus(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Cycle through statuses
            switch(order.kitchenStatus) {
                case KITCHEN_STATUS.PENDING:
                    order.kitchenStatus = KITCHEN_STATUS.PREPARING;
                    break;
                case KITCHEN_STATUS.PREPARING:
                    order.kitchenStatus = KITCHEN_STATUS.READY;
                    break;
                case KITCHEN_STATUS.READY:
                    order.kitchenStatus = KITCHEN_STATUS.COMPLETED;
                    break;
                case KITCHEN_STATUS.COMPLETED:
                    order.kitchenStatus = KITCHEN_STATUS.PENDING;
                    break;
                default:
                    order.kitchenStatus = KITCHEN_STATUS.PENDING;
            }
            
            saveData();
        }

        function printKitchenTicket(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            const printContent = generatePrintContent(order, 'kitchen');
            document.getElementById('bill-print-content').innerHTML = printContent;
            
            // Show print dialog
            window.print();
        }

        function startKitchenUpdateChecker() {
            // Check for updates every X seconds (based on settings)
            const refreshRate = restaurantData.settings.kdsRefreshRate * 1000 || 10000;
            
            setInterval(() => {
                if (restaurantData.settings.enableKDS) {
                    updateKitchenView();
                    
                    // Play sound if there are pending orders
                    const pendingOrders = restaurantData.orders.filter(order => 
                        order.kitchenStatus === KITCHEN_STATUS.PENDING && 
                        order.status !== 'completed'
                    ).length;
                    
                    if (pendingOrders > 0 && restaurantData.settings.kitchenSettings.soundEnabled) {
                        // In a real app, play a notification sound
                        console.log('New pending orders - playing sound');
                    }
                }
            }, refreshRate);
        }

        // Dashboard functions
        function updateDashboard() {
            // Today's date
            const today = new Date().toISOString().split('T')[0];
            
            // Filter today's orders
            const todayOrders = restaurantData.orders.filter(order => {
                return order.date.split('T')[0] === today;
            });
            
            // Calculate today's revenue
            const todayRevenue = todayOrders.reduce((total, order) => {
                return total + calculateOrderTotal(order);
            }, 0);
            
            // Update dashboard numbers
            document.getElementById('today-orders').textContent = todayOrders.length;
            document.getElementById('today-revenue').textContent = `${restaurantData.settings.currencySymbol}${todayRevenue.toFixed(2)}`;
            
            // Active tables (orders with pending status)
            const activeTables = restaurantData.tables.filter(table => table.status === 'occupied').length;
            document.getElementById('active-tables').textContent = activeTables;
            
            // Kitchen orders (pending and preparing)
            const kitchenOrders = restaurantData.orders.filter(order => 
                (order.kitchenStatus === KITCHEN_STATUS.PENDING || 
                 order.kitchenStatus === KITCHEN_STATUS.PREPARING) && 
                order.status !== 'completed'
            ).length;
            document.getElementById('kitchen-orders').textContent = kitchenOrders;
            
            // Recent orders
            const recentOrdersTable = document.getElementById('recent-orders');
            recentOrdersTable.innerHTML = '';
            
            const recentOrders = [...restaurantData.orders].reverse().slice(0, 5);
            recentOrders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id || 'N/A'}</td>
                    <td>${order.orderType === 'dine-in' ? 'Table ' + order.tableNumber : order.orderType}</td>
                    <td>${restaurantData.settings.currencySymbol}${calculateOrderTotal(order).toFixed(2)}</td>
                    <td><span class="badge ${order.status === 'completed' ? 'bg-success' : 'bg-warning'}">${order.status}</span></td>
                `;
                recentOrdersTable.appendChild(row);
            });
            
            // Popular items
            const popularItemsTable = document.getElementById('popular-items');
            popularItemsTable.innerHTML = '';
            
            // Count item sales
            const itemSales = {};
            restaurantData.orders.forEach(order => {
                order.items.forEach(item => {
                    if (itemSales[item.name]) {
                        itemSales[item.name].quantity += item.quantity;
                        itemSales[item.name].revenue += item.price * item.quantity;
                    } else {
                        itemSales[item.name] = {
                            quantity: item.quantity,
                            revenue: item.price * item.quantity
                        };
                    }
                });
            });
            
            // Convert to array and sort by quantity
            const popularItems = Object.entries(itemSales)
                .map(([name, data]) => ({ name, ...data }))
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);
            
            // Add to table
            popularItems.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${restaurantData.settings.currencySymbol}${item.revenue.toFixed(2)}</td>
                `;
                popularItemsTable.appendChild(row);
            });
        }

        // Table management functions
        function updateTables() {
            const tableGrid = document.getElementById('table-status-grid');
            tableGrid.innerHTML = '';
            
            restaurantData.tables.forEach(table => {
                const tableDiv = document.createElement('div');
                tableDiv.className = `table-status ${table.status}`;
                
                // Get order details if table is occupied
                let orderDetails = '';
                if (table.status === 'occupied') {
                    const order = restaurantData.orders.find(o => o.id === table.orderId);
                    if (order) {
                        orderDetails = `
                            <small>Order: ${order.id}</small><br>
                            <small>${order.items.length} items</small>
                        `;
                    }
                } else if (table.status === 'reserved') {
                    const reservation = restaurantData.reservations.find(r => r.tableNumber === table.number);
                    if (reservation) {
                        orderDetails = `
                            <small>Reserved for: ${reservation.customerName}</small><br>
                            <small>Time: ${new Date(reservation.time).toLocaleTimeString()}</small>
                        `;
                    }
                }
                
                tableDiv.innerHTML = `
                    <div class="text-center">
                        <span class="table-badge badge bg-dark">${table.capacity || 4} seats</span>
                        ${table.status === 'occupied' ? `<span class="order-type-badge badge bg-primary">Dine-in</span>` : ''}
                        ${table.status === 'reserved' ? `<span class="order-type-badge badge bg-warning">Reserved</span>` : ''}
                        <h5>Table ${table.number}</h5>
                        <p class="mb-0">${table.status.toUpperCase()}</p>
                        ${orderDetails}
                    </div>
                `;
                
                tableDiv.addEventListener('click', () => handleTableClick(table.number));
                
                tableGrid.appendChild(tableDiv);
            });
        }

        function updateActiveOrdersList() {
            const activeOrdersList = document.getElementById('active-orders-list');
            activeOrdersList.innerHTML = '';
            
            const activeOrders = restaurantData.orders.filter(order => order.status === 'pending');
            
            if (activeOrders.length === 0) {
                activeOrdersList.innerHTML = `
                    <div class="list-group-item text-center text-muted">
                        No active orders
                    </div>
                `;
                return;
            }
            
            activeOrders.forEach(order => {
                const orderItem = document.createElement('a');
                orderItem.className = 'list-group-item list-group-item-action';
                orderItem.href = '#';
                
                orderItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Order #${order.id}</h6>
                            <small>${order.orderType === 'dine-in' ? 'Table ' + order.tableNumber : order.orderType}</small>
                        </div>
                        <div>
                            <span class="badge bg-primary">${order.items.length} items</span>
                        </div>
                    </div>
                `;
                
                orderItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    viewOrderDetails(order.id);
                });
                
                activeOrdersList.appendChild(orderItem);
            });
        }

        function updateTableDropdowns() {
            const tableSelect = document.getElementById('table-number');
            const removeTableSelect = document.getElementById('remove-table-number');
            const reserveTableSelect = document.getElementById('reserve-table-number');
            
            tableSelect.innerHTML = '';
            removeTableSelect.innerHTML = '';
            reserveTableSelect.innerHTML = '';
            
            // Add default option for takeaway/delivery
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'N/A (Takeaway/Delivery)';
            tableSelect.appendChild(defaultOption);
            
            restaurantData.tables.forEach(table => {
                const option = document.createElement('option');
                option.value = table.number;
                option.textContent = `Table ${table.number} (${table.status})`;
                option.disabled = table.status !== 'available';
                tableSelect.appendChild(option);
                
                const removeOption = document.createElement('option');
                removeOption.value = table.number;
                removeOption.textContent = `Table ${table.number}`;
                removeTableSelect.appendChild(removeOption);
                
                const reserveOption = document.createElement('option');
                reserveOption.value = table.number;
                reserveOption.textContent = `Table ${table.number}`;
                reserveOption.disabled = table.status !== 'available';
                reserveTableSelect.appendChild(reserveOption);
            });
            
            // Set current table in dropdown
            if (currentOrder.tableNumber) {
                tableSelect.value = currentOrder.tableNumber;
                document.getElementById('current-table-number').textContent = currentOrder.tableNumber;
            }
        }

        function addTable(tableNumber, capacity = 4, location = 'main') {
            if (!tableNumber || isNaN(tableNumber) || tableNumber <= 0) {
                showNotification('Please enter a valid table number', 'danger');
                return;
            }
            
            if (restaurantData.tables.some(table => table.number === tableNumber)) {
                showNotification('Table already exists', 'danger');
                return;
            }
            
            restaurantData.tables.push({
                number: tableNumber,
                status: 'available',
                capacity: capacity,
                location: location,
                orderId: null
            });
            
            saveData();
            const modal = bootstrap.Modal.getInstance(document.getElementById('addTableModal'));
            modal.hide();
            showNotification(`Table ${tableNumber} added successfully`, 'success');
        }

        function removeTable(tableNumber) {
            if (!tableNumber) {
                showNotification('Please select a table to remove', 'danger');
                return;
            }
            
            // Check if table has active orders
            const table = restaurantData.tables.find(t => t.number === tableNumber);
            if (table && table.status === 'occupied') {
                if (confirm('This table has an active order. Remove it anyway?')) {
                    // Cancel the order
                    const orderIndex = restaurantData.orders.findIndex(o => o.id === table.orderId);
                    if (orderIndex !== -1) {
                        restaurantData.orders.splice(orderIndex, 1);
                    }
                } else {
                    return;
                }
            }
            
            restaurantData.tables = restaurantData.tables.filter(t => t.number !== tableNumber);
            saveData();
            const modal = bootstrap.Modal.getInstance(document.getElementById('removeTableModal'));
            modal.hide();
            showNotification(`Table ${tableNumber} removed successfully`, 'success');
        }

        function reserveTable(tableNumber, customerName, customerPhone, reservationTime, guests, notes = '') {
            const table = restaurantData.tables.find(t => t.number === tableNumber);
            if (!table) return;
            
            // Create reservation
            const reservation = {
                id: 'RES-' + Date.now().toString().slice(-6),
                tableNumber: tableNumber,
                customerName: customerName,
                customerPhone: customerPhone,
                time: new Date(reservationTime).toISOString(),
                guests: guests,
                notes: notes,
                status: 'confirmed'
            };
            
            restaurantData.reservations.push(reservation);
            
            // Update table status
            table.status = 'reserved';
            
            saveData();
            const modal = bootstrap.Modal.getInstance(document.getElementById('reserveTableModal'));
            modal.hide();
            
            showNotification(`Table ${tableNumber} has been reserved for ${customerName}`, 'success');
        }

        function updateTableStatus(tableNumber, status, orderId = null) {
            const table = restaurantData.tables.find(t => t.number === tableNumber);
            if (table) {
                table.status = status;
                table.orderId = orderId;
                saveData();
            }
        }

        // Orders section functions
        function updateCategories() {
            const categoriesContainer = document.getElementById('categories');
            categoriesContainer.innerHTML = '';
            
            restaurantData.categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'btn btn-outline-primary category-btn';
                button.textContent = category;
                button.dataset.category = category;
                button.addEventListener('click', () => filterMenuItems(category));
                categoriesContainer.appendChild(button);
            });
            
            // Add "All" button
            const allButton = document.createElement('button');
            allButton.className = 'btn btn-primary category-btn';
            allButton.textContent = 'All';
            allButton.addEventListener('click', () => filterMenuItems('all'));
            categoriesContainer.prepend(allButton);
        }

        function updateMenuItems(category = 'all') {
            const menuItemsContainer = document.getElementById('menu-items');
            menuItemsContainer.innerHTML = '';
            
            let itemsToShow = [...restaurantData.menuItems];
            
            if (category !== 'all') {
                itemsToShow = itemsToShow.filter(item => item.category === category);
            }
            
            // Apply search filter if any
            const searchTerm = document.getElementById('menu-search').value.toLowerCase();
            if (searchTerm) {
                itemsToShow = itemsToShow.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) || 
                    (item.description && item.description.toLowerCase().includes(searchTerm))
                );
            }
            
            if (itemsToShow.length === 0) {
                menuItemsContainer.innerHTML = `
                    <div class="col-12 text-center text-muted py-4">
                        <i class="fas fa-utensils fa-3x mb-3"></i>
                        <p>No items found</p>
                    </div>
                `;
                return;
            }
            
            itemsToShow.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col-md-4 mb-3';
                
                const card = document.createElement('div');
                card.className = 'card menu-item-card';
                card.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title">${item.name}</h5>
                        <p class="card-text">${restaurantData.settings.currencySymbol}${item.price.toFixed(2)}</p>
                        ${item.description ? `<p class="card-text text-muted small">${item.description}</p>` : ''}
                        <button class="btn btn-sm btn-primary add-to-order" data-id="${item.id}">Add to Order</button>
                    </div>
                `;
                
                col.appendChild(card);
                menuItemsContainer.appendChild(col);
            });
            
            // Add event listeners to add-to-order buttons
            document.querySelectorAll('.add-to-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemId = e.target.dataset.id;
                    addItemToOrder(itemId);
                });
            });
        }

        function filterMenuItems(category) {
            // Update active category button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline-primary');
            });
            
            const activeButton = document.querySelector(`.category-btn[data-category="${category}"]`) || 
                                document.querySelector('.category-btn:first-child');
            if (activeButton) {
                activeButton.classList.remove('btn-outline-primary');
                activeButton.classList.add('btn-primary');
            }
            
            updateMenuItems(category);
        }

        function addItemToOrder(itemId) {
            const item = restaurantData.menuItems.find(i => i.id === itemId);
            if (!item) return;
            
            // Check if item already exists in order
            const existingItem = currentOrder.items.find(i => i.id === itemId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                currentOrder.items.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: 1
                });
            }
            
            updateOrderItems();
            showNotification(`${item.name} added to order`, 'success');
            
            // Auto-scroll to order items
            document.getElementById('order-items').scrollIntoView({ behavior: 'smooth' });
        }

        function updateOrderItems() {
            const orderItemsContainer = document.getElementById('order-items');
            
            if (currentOrder.items.length === 0) {
                orderItemsContainer.innerHTML = '<p class="text-muted text-center">No items added yet</p>';
                updateOrderTotals();
                return;
            }
            
            orderItemsContainer.innerHTML = '';
            
            currentOrder.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'order-item d-flex justify-content-between align-items-center';
                itemDiv.innerHTML = `
                    <div>
                        <h6 class="mb-0">${item.name}</h6>
                        <small class="text-muted">${restaurantData.settings.currencySymbol}${item.price.toFixed(2)} × ${item.quantity}</small>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="btn-group btn-group-sm me-2">
                            <button class="btn btn-outline-secondary decrease-item" data-index="${index}">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button class="btn btn-outline-secondary increase-item" data-index="${index}">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <span class="me-3">${restaurantData.settings.currencySymbol}${(item.price * item.quantity).toFixed(2)}</span>
                        <button class="btn btn-sm btn-outline-danger remove-item" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                orderItemsContainer.appendChild(itemDiv);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.closest('button').dataset.index);
                    removeItemFromOrder(index);
                });
            });
            
            // Add event listeners to increase buttons
            document.querySelectorAll('.increase-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.closest('button').dataset.index);
                    increaseItemQuantity(index);
                });
            });
            
            // Add event listeners to decrease buttons
            document.querySelectorAll('.decrease-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.closest('button').dataset.index);
                    decreaseItemQuantity(index);
                });
            });
            
            // Update totals
            updateOrderTotals();
        }

        function removeItemFromOrder(index) {
            const removedItem = currentOrder.items[index];
            currentOrder.items.splice(index, 1);
            updateOrderItems();
            showNotification(`${removedItem.name} removed from order`, 'info');
        }

        function increaseItemQuantity(index) {
            currentOrder.items[index].quantity += 1;
            updateOrderItems();
        }

        function decreaseItemQuantity(index) {
            if (currentOrder.items[index].quantity > 1) {
                currentOrder.items[index].quantity -= 1;
                updateOrderItems();
            } else {
                removeItemFromOrder(index);
            }
        }

        function updateOrderTotals() {
            const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * (restaurantData.settings.taxRate / 100);
            const service = subtotal * (restaurantData.settings.serviceCharge / 100);
            const total = subtotal + tax + service;
            
            document.getElementById('order-subtotal').textContent = `${restaurantData.settings.currencySymbol}${subtotal.toFixed(2)}`;
            document.getElementById('order-tax').textContent = `${restaurantData.settings.currencySymbol}${tax.toFixed(2)}`;
            document.getElementById('order-service').textContent = `${restaurantData.settings.currencySymbol}${service.toFixed(2)}`;
            document.getElementById('order-total').textContent = `${restaurantData.settings.currencySymbol}${total.toFixed(2)}`;
            
            // Update tax and service charge display
            document.getElementById('tax-rate-display').textContent = restaurantData.settings.taxRate;
            document.getElementById('service-charge-display').textContent = restaurantData.settings.serviceCharge;
        }

        function printKitchenOrder() {
            if (currentOrder.items.length === 0) {
                showNotification('Please add items to the order before printing', 'warning');
                return;
            }
            
            const printContent = generatePrintContent(currentOrder, 'kitchen');
            document.getElementById('bill-print-content').innerHTML = printContent;
            
            // Show print dialog
            window.print();
            
            if (restaurantData.settings.autoPrintKitchen) {
                // In a real app, this would send to a kitchen printer
                console.log('Auto-printing kitchen order...');
            }
        }

        function confirmOrder() {
            if (currentOrder.items.length === 0) {
                showNotification('Please add items to the order before confirming', 'warning');
                return;
            }

            // Validate required fields
            if (currentOrder.orderType === 'dine-in' && !currentOrder.tableNumber) {
                showNotification('Please select a table for dine-in orders', 'warning');
                return;
            }

            if (!document.getElementById('customer-name').value.trim()) {
                showNotification('Please enter customer name', 'warning');
                return;
            }

            // Update current order with form values
            currentOrder.orderType = document.getElementById('order-type').value;
            currentOrder.tableNumber = parseInt(document.getElementById('table-number').value) || null;
            currentOrder.customerName = document.getElementById('customer-name').value || 'Walk-in Customer';
            currentOrder.customerPhone = document.getElementById('customer-phone').value || '';
            currentOrder.notes = document.getElementById('order-notes').value || '';

            // Populate confirmation modal
            populateConfirmationModal();
            
            // Show confirmation modal
            const modal = new bootstrap.Modal(document.getElementById('orderConfirmationModal'));
            modal.show();
        }

        function populateConfirmationModal() {
            // Basic info
            document.getElementById('confirm-table').textContent = 
                currentOrder.orderType === 'dine-in' ? `Table ${currentOrder.tableNumber}` : 'N/A';
            document.getElementById('confirm-order-type').textContent = 
                currentOrder.orderType.charAt(0).toUpperCase() + currentOrder.orderType.slice(1);
            document.getElementById('confirm-customer').textContent = currentOrder.customerName || 'Walk-in Customer';
            document.getElementById('confirm-phone').textContent = currentOrder.customerPhone || 'Not provided';
            document.getElementById('confirm-notes').textContent = currentOrder.notes || 'None';

            // Items
            const itemsContainer = document.getElementById('confirm-items');
            itemsContainer.innerHTML = '';
            
            currentOrder.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'order-summary-item';
                itemDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong>
                        <small class="text-muted d-block">${restaurantData.settings.currencySymbol}${item.price.toFixed(2)} × ${item.quantity}</small>
                    </div>
                    <div>
                        <strong>${restaurantData.settings.currencySymbol}${(item.price * item.quantity).toFixed(2)}</strong>
                    </div>
                `;
                itemsContainer.appendChild(itemDiv);
            });

            // Totals
            const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * (restaurantData.settings.taxRate / 100);
            const service = subtotal * (restaurantData.settings.serviceCharge / 100);
            const total = subtotal + tax + service;

            document.getElementById('confirm-subtotal').textContent = `${restaurantData.settings.currencySymbol}${subtotal.toFixed(2)}`;
            document.getElementById('confirm-tax').textContent = `${restaurantData.settings.currencySymbol}${tax.toFixed(2)}`;
            document.getElementById('confirm-service').textContent = `${restaurantData.settings.currencySymbol}${service.toFixed(2)}`;
            document.getElementById('confirm-total').textContent = `${restaurantData.settings.currencySymbol}${total.toFixed(2)}`;
        }

        function finalConfirmOrder() {
            // Generate order ID
            const orderId = 'ORD-' + Date.now().toString().slice(-6);
            
            // Create order object
            const order = {
                id: orderId,
                ...currentOrder,
                date: new Date().toISOString(),
                status: 'pending',
                kitchenStatus: KITCHEN_STATUS.PENDING
            };
            
            // Add to orders
            restaurantData.orders.push(order);
            
            // Update table status if dine-in
            if (order.orderType === 'dine-in' && order.tableNumber) {
                updateTableStatus(order.tableNumber, 'occupied', orderId);
            }
            
            saveData();
            
            // Print kitchen order if enabled
            if (restaurantData.settings.autoPrintKitchen) {
                const printContent = generatePrintContent(order, 'kitchen');
                document.getElementById('bill-print-content').innerHTML = printContent;
                setTimeout(() => window.print(), 500);
            }
            
            // Reset current order
            currentOrder.items = [];
            currentOrder.tableNumber = null;
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('order-notes').value = '';
            document.getElementById('current-table-number').textContent = 'Select Table';
            updateOrderItems();
            
            // Hide modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('orderConfirmationModal'));
            modal.hide();
            
            showNotification(`Order ${orderId} confirmed and sent to kitchen!`, 'success');
        }

        function completeOrderById(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            order.status = 'completed';
            order.kitchenStatus = KITCHEN_STATUS.COMPLETED;
            
            // Update table status if dine-in
            if (order.orderType === 'dine-in') {
                updateTableStatus(order.tableNumber, 'available');
            }
            
            saveData();
            
            // Print customer bill
            const printContent = generatePrintContent(order, 'customer');
            document.getElementById('bill-print-content').innerHTML = printContent;
            window.print();
            
            showNotification(`Order ${orderId} completed successfully!`, 'success');
        }

        // Menu management functions
        function updateMenuManagement() {
            // Update category dropdown
            const categorySelect = document.getElementById('item-category');
            categorySelect.innerHTML = '';
            
            restaurantData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
            
            // Update kitchen categories dropdown
            const kitchenCategories = document.getElementById('kitchen-categories');
            kitchenCategories.innerHTML = '';
            
            restaurantData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                if (restaurantData.settings.kitchenSettings.categories.includes(category)) {
                    option.selected = true;
                }
                kitchenCategories.appendChild(option);
            });
            
            // Update menu items accordion
            const accordion = document.getElementById('menu-categories-accordion');
            accordion.innerHTML = '';
            
            restaurantData.categories.forEach((category, index) => {
                const categoryItems = restaurantData.menuItems.filter(item => item.category === category);
                
                const accordionItem = document.createElement('div');
                accordionItem.className = 'accordion-item';
                
                const accordionHeader = document.createElement('h2');
                accordionHeader.className = 'accordion-header';
                accordionHeader.id = `heading-${index}`;
                
                const accordionButton = document.createElement('button');
                accordionButton.className = 'accordion-button';
                accordionButton.type = 'button';
                accordionButton.dataset.bsToggle = 'collapse';
                accordionButton.dataset.bsTarget = `#collapse-${index}`;
                accordionButton.setAttribute('aria-expanded', index === 0 ? 'true' : 'false');
                accordionButton.setAttribute('aria-controls', `collapse-${index}`);
                accordionButton.textContent = `${category} (${categoryItems.length} items)`;
                
                accordionHeader.appendChild(accordionButton);
                
                const accordionCollapse = document.createElement('div');
                accordionCollapse.className = `accordion-collapse collapse ${index === 0 ? 'show' : ''}`;
                accordionCollapse.id = `collapse-${index}`;
                accordionCollapse.setAttribute('aria-labelledby', `heading-${index}`);
                accordionCollapse.dataset.bsParent = '#menu-categories-accordion';
                
                const accordionBody = document.createElement('div');
                accordionBody.className = 'accordion-body';
                
                if (categoryItems.length === 0) {
                    accordionBody.innerHTML = '<p class="text-muted">No items in this category</p>';
                } else {
                    const table = document.createElement('table');
                    table.className = 'table table-sm';
                    
                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr>
                            <th>Item</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    `;
                    
                    const tbody = document.createElement('tbody');
                    
                    categoryItems.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <strong>${item.name}</strong>
                                ${item.description ? `<small class="d-block text-muted">${item.description}</small>` : ''}
                            </td>
                            <td>${restaurantData.settings.currencySymbol}${item.price.toFixed(2)}</td>
                            <td>
                                <span class="badge ${item.available ? 'bg-success' : 'bg-secondary'}">
                                    ${item.available ? 'Available' : 'Unavailable'}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary edit-item me-1" data-id="${item.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-item" data-id="${item.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    table.appendChild(thead);
                    table.appendChild(tbody);
                    accordionBody.appendChild(table);
                }
                
                accordionCollapse.appendChild(accordionBody);
                accordionItem.appendChild(accordionHeader);
                accordionItem.appendChild(accordionCollapse);
                accordion.appendChild(accordionItem);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemId = e.target.closest('button').dataset.id;
                    deleteMenuItem(itemId);
                });
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemId = e.target.closest('button').dataset.id;
                    editMenuItem(itemId);
                });
            });
        }

        function addCategory() {
            const categoryName = document.getElementById('category-name').value.trim();
            
            if (!categoryName) {
                showNotification('Please enter a category name', 'warning');
                return;
            }
            
            if (restaurantData.categories.includes(categoryName)) {
                showNotification('Category already exists', 'warning');
                return;
            }
            
            restaurantData.categories.push(categoryName);
            document.getElementById('category-name').value = '';
            saveData();
            showNotification(`Category "${categoryName}" added successfully`, 'success');
        }

        function addMenuItem() {
            const category = document.getElementById('item-category').value;
            const name = document.getElementById('item-name').value.trim();
            const price = parseFloat(document.getElementById('item-price').value);
            const description = document.getElementById('item-description').value.trim();
            const available = document.getElementById('item-availability').checked;
            
            if (!name || isNaN(price) || price <= 0) {
                showNotification('Please fill all required fields with valid values', 'warning');
                return;
            }
            
            // Generate item ID
            const id = 'ITEM-' + Date.now().toString().slice(-6);
            
            restaurantData.menuItems.push({
                id,
                name,
                price,
                category,
                description,
                available
            });
            
            // Clear form
            document.getElementById('item-name').value = '';
            document.getElementById('item-price').value = '';
            document.getElementById('item-description').value = '';
            
            saveData();
            showNotification(`Menu item "${name}" added successfully`, 'success');
        }

        function editMenuItem(itemId) {
            const item = restaurantData.menuItems.find(i => i.id === itemId);
            if (!item) return;
            
            // In a real app, you would show a modal with the item details for editing
            showNotification(`Editing item: ${item.name}\nThis would open an edit form in a real application.`, 'info');
        }

        function deleteMenuItem(itemId) {
            const item = restaurantData.menuItems.find(i => i.id === itemId);
            if (!item) return;
            
            if (confirm(`Are you sure you want to delete "${item.name}"?`)) {
                restaurantData.menuItems = restaurantData.menuItems.filter(item => item.id !== itemId);
                saveData();
                showNotification(`Menu item "${item.name}" deleted successfully`, 'success');
            }
        }

        // Reports functions
        function updateAllOrdersTable() {
            const tableBody = document.getElementById('all-orders-table');
            tableBody.innerHTML = '';
            
            const sortedOrders = [...restaurantData.orders].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedOrders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${new Date(order.date).toLocaleString()}</td>
                    <td>${order.orderType === 'dine-in' ? 'Table ' + order.tableNumber : order.orderType}</td>
                    <td>${order.customerName}</td>
                    <td>${restaurantData.settings.currencySymbol}${calculateOrderTotal(order).toFixed(2)}</td>
                    <td>
                        <span class="badge ${order.status === 'completed' ? 'bg-success' : 'bg-warning'}">
                            ${order.status}
                        </span>
                        ${order.kitchenStatus ? `<span class="badge bg-${getStatusBadgeColor(order.kitchenStatus)} ms-1">
                            ${order.kitchenStatus}
                        </span>` : ''}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary view-order me-1" data-id="${order.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success complete-order me-1" data-id="${order.id}">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-order" data-id="${order.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.view-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.id;
                    viewOrderDetails(orderId);
                });
            });
            
            document.querySelectorAll('.complete-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.id;
                    completeOrderById(orderId);
                });
            });
            
            document.querySelectorAll('.delete-order').forEach(button => {
                button.addEventListener('click', (e) => {
                    const orderId = e.target.closest('button').dataset.id;
                    deleteOrder(orderId);
                });
            });
        }

        function updateOrderPreview() {
            const orderId = document.getElementById('bill-order-id').value;
            if (!orderId) return;
            
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) {
                document.getElementById('order-preview').innerHTML = `
                    <div class="alert alert-danger">Order not found</div>
                `;
                return;
            }
            
            let itemsList = '';
            order.items.forEach(item => {
                itemsList += `
                    <tr>
                        <td>${item.name}</td>
                        <td class="text-end">${item.quantity}</td>
                        <td class="text-end">${restaurantData.settings.currencySymbol}${(item.price * item.quantity).toFixed(2)}</td>
                    </tr>
                `;
            });
            
            const subtotal = calculateOrderTotal(order);
            const tax = subtotal * (restaurantData.settings.taxRate / 100);
            const service = subtotal * (restaurantData.settings.serviceCharge / 100);
            const grandTotal = subtotal + tax + service;
            
            document.getElementById('order-preview').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h5>Order Preview</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <p><strong>Order #:</strong> ${order.id}</p>
                                <p><strong>Customer:</strong> ${order.customerName}</p>
                            </div>
                            <div class="col-6 text-end">
                                <p><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</p>
                                <p><strong>Type:</strong> ${order.orderType === 'dine-in' ? 'Table ' + order.tableNumber : order.orderType}</p>
                            </div>
                        </div>
                        
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th class="text-end">Qty</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsList}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th colspan="2">Subtotal:</th>
                                    <th class="text-end">${restaurantData.settings.currencySymbol}${subtotal.toFixed(2)}</th>
                                </tr>
                                <tr>
                                    <th colspan="2">Tax (${restaurantData.settings.taxRate}%):</th>
                                    <th class="text-end">${restaurantData.settings.currencySymbol}${tax.toFixed(2)}</th>
                                </tr>
                                <tr>
                                    <th colspan="2">Service Charge (${restaurantData.settings.serviceCharge}%):</th>
                                    <th class="text-end">${restaurantData.settings.currencySymbol}${service.toFixed(2)}</th>
                                </tr>
                                <tr>
                                    <th colspan="2">Grand Total:</th>
                                    <th class="text-end">${restaurantData.settings.currencySymbol}${grandTotal.toFixed(2)}</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            `;
        }

        function viewOrderDetails(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Set the order ID in the print form
            document.getElementById('bill-order-id').value = orderId;
            updateOrderPreview();
            
            // Switch to reports tab
            document.querySelector('[data-section="reports"]').click();
        }

        function deleteOrder(orderId) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            if (confirm(`Are you sure you want to delete order ${orderId}?`)) {
                // Update table status if order was active and dine-in
                if (order.status === 'pending' && order.orderType === 'dine-in') {
                    updateTableStatus(order.tableNumber, 'available');
                }
                
                restaurantData.orders = restaurantData.orders.filter(order => order.id !== orderId);
                saveData();
                showNotification(`Order ${orderId} deleted successfully`, 'success');
            }
        }

        function generateSalesReport() {
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const reportType = document.getElementById('report-type').value;
            
            if (!startDate || !endDate) {
                showNotification('Please select both start and end dates', 'warning');
                return;
            }
            
            const filteredOrders = restaurantData.orders.filter(order => {
                const orderDate = order.date.split('T')[0];
                return orderDate >= startDate && orderDate <= endDate;
            });
            
            if (filteredOrders.length === 0) {
                document.getElementById('sales-report-results').innerHTML = `
                    <div class="alert alert-info">No orders found for the selected date range</div>
                `;
                return;
            }
            
            // Calculate totals
            const totalOrders = filteredOrders.length;
            const totalRevenue = filteredOrders.reduce((sum, order) => sum + calculateOrderTotal(order), 0);
            const avgOrderValue = totalRevenue / totalOrders;
            
            // Group by category
            const categorySales = {};
            filteredOrders.forEach(order => {
                order.items.forEach(item => {
                    const menuItem = restaurantData.menuItems.find(mi => mi.id === item.id);
                    if (menuItem) {
                        if (categorySales[menuItem.category]) {
                            categorySales[menuItem.category].quantity += item.quantity;
                            categorySales[menuItem.category].revenue += item.price * item.quantity;
                        } else {
                            categorySales[menuItem.category] = {
                                quantity: item.quantity,
                                revenue: item.price * item.quantity
                            };
                        }
                    }
                });
            });
            
            // Group by hour
            const hourlySales = {};
            filteredOrders.forEach(order => {
                const hour = new Date(order.date).getHours();
                const hourLabel = `${hour}:00 - ${hour + 1}:00`;
                
                if (hourlySales[hourLabel]) {
                    hourlySales[hourLabel].orders += 1;
                    hourlySales[hourLabel].revenue += calculateOrderTotal(order);
                } else {
                    hourlySales[hourLabel] = {
                        orders: 1,
                        revenue: calculateOrderTotal(order)
                    };
                }
            });
            
            // Create category sales table
            let categoryTable = '';
            for (const [category, data] of Object.entries(categorySales)) {
                categoryTable += `
                    <tr>
                        <td>${category}</td>
                        <td>${data.quantity}</td>
                        <td>${restaurantData.settings.currencySymbol}${data.revenue.toFixed(2)}</td>
                        <td>${((data.revenue / totalRevenue) * 100).toFixed(1)}%</td>
                    </tr>
                `;
            }
            
            // Create hourly sales table
            let hourlyTable = '';
            for (const [hour, data] of Object.entries(hourlySales)) {
                hourlyTable += `
                    <tr>
                        <td>${hour}</td>
                        <td>${data.orders}</td>
                        <td>${restaurantData.settings.currencySymbol}${data.revenue.toFixed(2)}</td>
                        <td>${restaurantData.settings.currencySymbol}${(data.revenue / data.orders).toFixed(2)}</td>
                    </tr>
                `;
            }
            
            // Display results based on report type
            let reportContent = '';
            
            switch(reportType) {
                case 'summary':
                    reportContent = `
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title">Total Orders</h6>
                                        <h3 class="card-text">${totalOrders}</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title">Total Revenue</h6>
                                        <h3 class="card-text">${restaurantData.settings.currencySymbol}${totalRevenue.toFixed(2)}</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title">Avg. Order Value</h6>
                                        <h3 class="card-text">${restaurantData.settings.currencySymbol}${avgOrderValue.toFixed(2)}</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h5>Sales by Category</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Quantity Sold</th>
                                    <th>Revenue</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${categoryTable}
                            </tbody>
                        </table>
                    `;
                    break;
                    
                case 'detailed':
                    // Detailed report would show all orders in the period
                    let detailedOrders = '';
                    filteredOrders.forEach(order => {
                        detailedOrders += `
                            <tr>
                                <td>${order.id}</td>
                                <td>${new Date(order.date).toLocaleString()}</td>
                                <td>${order.orderType === 'dine-in' ? 'Table ' + order.tableNumber : order.orderType}</td>
                                <td>${order.customerName}</td>
                                <td>${order.items.length}</td>
                                <td>${restaurantData.settings.currencySymbol}${calculateOrderTotal(order).toFixed(2)}</td>
                            </tr>
                        `;
                    });
                    
                    reportContent = `
                        <h5>Detailed Order Report</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Table/Type</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${detailedOrders}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                    
                case 'category':
                    reportContent = `
                        <h5>Category-wise Sales Report</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Quantity Sold</th>
                                    <th>Revenue</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${categoryTable}
                            </tbody>
                        </table>
                    `;
                    break;
                    
                case 'hourly':
                    reportContent = `
                        <h5>Hourly Sales Report</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Time Slot</th>
                                    <th>Orders</th>
                                    <th>Revenue</th>
                                    <th>Avg. Order Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${hourlyTable}
                            </tbody>
                        </table>
                    `;
                    break;
            }
            
            document.getElementById('sales-report-results').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h5>Sales Report: ${new Date(startDate).toLocaleDateString()} to ${new Date(endDate).toLocaleDateString()}</h5>
                    </div>
                    <div class="card-body">
                        ${reportContent}
                    </div>
                </div>
            `;
        }

        // Print functions
        function printBill(orderId, type) {
            const order = restaurantData.orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('Order not found', 'danger');
                return;
            }
            
            const printContent = generatePrintContent(order, type);
            document.getElementById('bill-print-content').innerHTML = printContent;
            
            // Show print dialog
            window.print();
        }

        function generatePrintContent(order, type) {
            const settings = restaurantData.settings;
            const orderTotal = calculateOrderTotal(order);
            const taxAmount = orderTotal * (settings.taxRate / 100);
            const serviceCharge = orderTotal * (settings.serviceCharge / 100);
            const grandTotal = orderTotal + taxAmount + serviceCharge;
            
            let content = '';
            
            // Header
            content += `
                <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px;">
                    <h2 style="margin: 0; font-size: 18px; font-weight: bold;">${settings.restaurantName}</h2>
                    <p style="margin: 2px 0; font-size: 12px;">${settings.address}</p>
                    <p style="margin: 2px 0; font-size: 12px;">Phone: ${settings.phone}</p>
                    ${settings.gst ? `<p style="margin: 2px 0; font-size: 12px;">GST: ${settings.gst}</p>` : ''}
                    <h3 style="margin: 10px 0; font-size: 14px; font-weight: bold;">${type === 'kitchen' ? 'KITCHEN ORDER' : type === 'admin' ? 'ADMIN COPY' : 'CUSTOMER COPY'}</h3>
                </div>
            `;
            
            // Order info
            content += `
                <div style="margin-bottom: 15px; font-size: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span><strong>Order #:</strong> ${order.id}</span>
                        <span><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span><strong>${order.orderType === 'dine-in' ? 'Table #:' : order.orderType === 'takeaway' ? 'Takeaway #:' : 'Delivery #:'}</strong> 
                               ${order.orderType === 'dine-in' ? order.tableNumber : order.id}</span>
                        <span><strong>Customer:</strong> ${order.customerName}</span>
                    </div>
                    ${order.customerPhone ? `<div><strong>Phone:</strong> ${order.customerPhone}</div>` : ''}
                </div>
            `;
            
            // Items table
            content += `
                <div style="border-top: 1px solid #000; border-bottom: 1px solid #000; padding: 10px 0; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 5px; font-size: 12px;">
                        <span style="width: 40%;">Item</span>
                        <span style="width: 15%; text-align: center;">Qty</span>
                        <span style="width: 20%; text-align: right;">Price</span>
                        ${type !== 'kitchen' ? '<span style="width: 25%; text-align: right;">Amount</span>' : ''}
                        ${type === 'kitchen' ? '<span style="width: 25%; text-align: right;">Status</span>' : ''}
                    </div>
            `;
            
            order.items.forEach(item => {
                content += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 3px; font-size: 11px;">
                        <span style="width: 40%;">${item.name}</span>
                        <span style="width: 15%; text-align: center;">${item.quantity}</span>
                        <span style="width: 20%; text-align: right;">${settings.currencySymbol}${item.price.toFixed(2)}</span>
                        ${type !== 'kitchen' ? `<span style="width: 25%; text-align: right;">${settings.currencySymbol}${(item.price * item.quantity).toFixed(2)}</span>` : ''}
                        ${type === 'kitchen' ? `<span style="width: 25%; text-align: right;">Pending</span>` : ''}
                    </div>
                `;
            });
            
            content += `</div>`;
            
            // Footer (only for admin and customer copies)
            if (type !== 'kitchen') {
                content += `
                    <div style="text-align: right; font-size: 12px; margin-bottom: 15px;">
                        <div style="margin-bottom: 3px;"><strong>Subtotal:</strong> ${settings.currencySymbol}${orderTotal.toFixed(2)}</div>
                        <div style="margin-bottom: 3px;"><strong>Tax (${settings.taxRate}%):</strong> ${settings.currencySymbol}${taxAmount.toFixed(2)}</div>
                        <div style="margin-bottom: 3px;"><strong>Service Charge (${settings.serviceCharge}%):</strong> ${settings.currencySymbol}${serviceCharge.toFixed(2)}</div>
                        <div style="font-size: 14px; font-weight: bold; border-top: 1px solid #000; padding-top: 5px; margin-top: 5px;">
                            <strong>Grand Total:</strong> ${settings.currencySymbol}${grandTotal.toFixed(2)}
                        </div>
                    </div>
                `;
                
                if (type === 'customer') {
                    content += `
                        <div style="text-align: center; margin-top: 20px; font-size: 12px; border-top: 1px solid #000; padding-top: 10px;">
                            <p style="margin: 5px 0; font-weight: bold;">Thank you for dining with us!</p>
                            <p style="margin: 5px 0;">Please visit again</p>
                        </div>
                    `;
                }
            } else {
                // Kitchen specific content
                content += `
                    <div style="text-align: center; margin-top: 15px; font-size: 12px; border-top: 1px solid #000; padding-top: 10px;">
                        <div style="margin-bottom: 5px;"><strong>Order Time:</strong> ${new Date(order.date).toLocaleTimeString()}</div>
                        ${order.notes ? `<div style="margin-bottom: 5px;"><strong>Notes:</strong> ${order.notes}</div>` : ''}
                        <div style="margin-top: 10px; font-style: italic;">Please prepare with care</div>
                    </div>
                `;
            }
            
            return content;
        }

        function calculateOrderTotal(order) {
            return order.items.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        // Settings functions
        function updateSettingsForm() {
            const settings = restaurantData.settings;
            
            document.getElementById('restaurant-name').value = settings.restaurantName;
            document.getElementById('restaurant-address').value = settings.address;
            document.getElementById('restaurant-phone').value = settings.phone;
            document.getElementById('restaurant-gst').value = settings.gst || '';
            
            document.getElementById('tax-rate').value = settings.taxRate;
            document.getElementById('service-charge').value = settings.serviceCharge;
            document.getElementById('currency-symbol').value = settings.currencySymbol;
            document.getElementById('enable-discount').checked = settings.enableDiscount;
            document.getElementById('auto-print-kitchen').checked = settings.autoPrintKitchen;
            document.getElementById('enable-kds').checked = settings.enableKDS;
            document.getElementById('kds-refresh-rate').value = settings.kdsRefreshRate;
        }

        function saveRestaurantInfo() {
            restaurantData.settings.restaurantName = document.getElementById('restaurant-name').value;
            restaurantData.settings.address = document.getElementById('restaurant-address').value;
            restaurantData.settings.phone = document.getElementById('restaurant-phone').value;
            restaurantData.settings.gst = document.getElementById('restaurant-gst').value;
            
            // Handle logo upload (in a real app, this would upload to a server)
            const logoInput = document.getElementById('restaurant-logo');
            if (logoInput.files.length > 0) {
                const file = logoInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // In a real app, you would save this to a server
                    console.log('Logo uploaded:', e.target.result);
                };
                
                reader.readAsDataURL(file);
            }
            
            saveData();
            showNotification('Restaurant information saved successfully', 'success');
        }

        function saveSystemSettings() {
            restaurantData.settings.taxRate = parseFloat(document.getElementById('tax-rate').value);
            restaurantData.settings.serviceCharge = parseFloat(document.getElementById('service-charge').value);
            restaurantData.settings.currencySymbol = document.getElementById('currency-symbol').value;
            restaurantData.settings.enableDiscount = document.getElementById('enable-discount').checked;
            restaurantData.settings.autoPrintKitchen = document.getElementById('auto-print-kitchen').checked;
            restaurantData.settings.enableKDS = document.getElementById('enable-kds').checked;
            restaurantData.settings.kdsRefreshRate = parseInt(document.getElementById('kds-refresh-rate').value);
            
            saveData();
            showNotification('System settings saved successfully', 'success');
        }

        function saveKitchenSettings() {
            const kitchenSettings = restaurantData.settings.kitchenSettings;
            
            kitchenSettings.name = document.getElementById('kitchen-name').value;
            kitchenSettings.printerIP = document.getElementById('kitchen-printer').value;
            kitchenSettings.soundEnabled = document.getElementById('kitchen-sound').checked;
            kitchenSettings.alertsEnabled = document.getElementById('kitchen-alerts').checked;
            
            // Get selected categories
            kitchenSettings.categories = [];
            const categorySelect = document.getElementById('kitchen-categories');
            for (let i = 0; i < categorySelect.options.length; i++) {
                if (categorySelect.options[i].selected) {
                    kitchenSettings.categories.push(categorySelect.options[i].value);
                }
            }
            
            saveData();
            const modal = bootstrap.Modal.getInstance(document.getElementById('kitchenSettingsModal'));
            modal.hide();
            showNotification('Kitchen settings saved successfully', 'success');
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                localStorage.removeItem('restaurantData');
                location.reload();
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Load data
            loadData();
            
            // Navigation
            document.querySelectorAll('[data-section]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    
                    // Show corresponding section
                    const sectionId = e.target.dataset.section;
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Save the active section to localStorage
                    localStorage.setItem('activeSection', sectionId);
                });
            });
            
            // Tables section
            document.getElementById('refresh-tables').addEventListener('click', updateTables);
            
            document.getElementById('toggle-view').addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-th-large')) {
                    icon.classList.remove('fa-th-large');
                    icon.classList.add('fa-list');
                    this.innerHTML = '<i class="fas fa-list me-1"></i> List View';
                    // Switch to list view (implementation would be similar)
                } else {
                    icon.classList.remove('fa-list');
                    icon.classList.add('fa-th-large');
                    this.innerHTML = '<i class="fas fa-th-large me-1"></i> Grid View';
                    updateTables();
                }
            });
            
            document.getElementById('confirm-add-table').addEventListener('click', () => {
                const tableNumber = parseInt(document.getElementById('new-table-number').value);
                const capacity = parseInt(document.getElementById('table-capacity').value) || 4;
                const location = document.getElementById('table-location').value;
                addTable(tableNumber, capacity, location);
            });
            
            document.getElementById('confirm-remove-table').addEventListener('click', () => {
                const tableNumber = parseInt(document.getElementById('remove-table-number').value);
                removeTable(tableNumber);
            });
            
            document.getElementById('confirm-reserve-table').addEventListener('click', () => {
                const tableNumber = parseInt(document.getElementById('reserve-table-number').value);
                const customerName = document.getElementById('reservation-name').value;
                const customerPhone = document.getElementById('reservation-phone').value;
                const reservationTime = document.getElementById('reservation-time').value;
                const guests = parseInt(document.getElementById('reservation-guests').value);
                const notes = document.getElementById('reservation-notes').value;
                
                if (!tableNumber || !customerName || !customerPhone || !reservationTime || !guests) {
                    showNotification('Please fill all required fields', 'warning');
                    return;
                }
                
                reserveTable(tableNumber, customerName, customerPhone, reservationTime, guests, notes);
            });
            
            // Orders section
            document.getElementById('order-type').addEventListener('change', (e) => {
                currentOrder.orderType = e.target.value;
                const tableSelect = document.getElementById('table-number');
                
                if (e.target.value === 'dine-in') {
                    tableSelect.disabled = false;
                    if (currentOrder.tableNumber) {
                        tableSelect.value = currentOrder.tableNumber;
                    }
                } else {
                    tableSelect.disabled = true;
                    tableSelect.value = '';
                    currentOrder.tableNumber = null;
                    document.getElementById('current-table-number').textContent = 'N/A';
                }
            });
            
            document.getElementById('table-number').addEventListener('change', (e) => {
                currentOrder.tableNumber = parseInt(e.target.value) || null;
                document.getElementById('current-table-number').textContent = e.target.value || 'N/A';
            });
            
            document.getElementById('customer-name').addEventListener('input', (e) => {
                currentOrder.customerName = e.target.value;
            });
            
            document.getElementById('customer-phone').addEventListener('input', (e) => {
                currentOrder.customerPhone = e.target.value;
            });
            
            document.getElementById('order-notes').addEventListener('input', (e) => {
                currentOrder.notes = e.target.value;
            });
            
            document.getElementById('clear-order').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the current order?')) {
                    currentOrder.items = [];
                    updateOrderItems();
                    showNotification('Order cleared', 'info');
                }
            });
            
            document.getElementById('print-kitchen-order').addEventListener('click', (e) => {
                e.preventDefault();
                printKitchenOrder();
            });
            
            document.getElementById('confirm-order').addEventListener('click', (e) => {
                e.preventDefault();
                confirmOrder();
            });

            document.getElementById('final-confirm-order').addEventListener('click', (e) => {
                e.preventDefault();
                finalConfirmOrder();
            });
            
            // Menu search
            document.getElementById('menu-search').addEventListener('input', () => {
                updateMenuItems();
            });
            
            document.getElementById('clear-search').addEventListener('click', () => {
                document.getElementById('menu-search').value = '';
                updateMenuItems();
            });
            
            // Kitchen section
            document.getElementById('refresh-kitchen').addEventListener('click', updateKitchenView);
            
            document.getElementById('kitchen-settings').addEventListener('click', () => {
                const modal = new bootstrap.Modal(document.getElementById('kitchenSettingsModal'));
                modal.show();
            });
            
            document.getElementById('save-kitchen-settings').addEventListener('click', saveKitchenSettings);
            
            // Menu management
            document.getElementById('add-category-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addCategory();
            });
            
            document.getElementById('add-item-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addMenuItem();
            });
            
            document.getElementById('export-menu').addEventListener('click', () => {
                // In a real app, this would export the menu to CSV or Excel
                showNotification('Menu exported successfully (this would download a file in a real app)', 'success');
            });
            
            // Reports
            document.getElementById('sales-report-form').addEventListener('submit', (e) => {
                e.preventDefault();
                generateSalesReport();
            });
            
            document.getElementById('export-report').addEventListener('click', () => {
                // In a real app, this would export the report to Excel
                showNotification('Report exported to Excel (this would download a file in a real app)', 'success');
            });
            
            document.getElementById('print-kitchen-bill').addEventListener('click', () => {
                const orderId = document.getElementById('bill-order-id').value;
                if (orderId) {
                    printBill(orderId, 'kitchen');
                } else {
                    showNotification('Please enter an order ID', 'warning');
                }
            });
            
            document.getElementById('print-customer-bill').addEventListener('click', () => {
                const orderId = document.getElementById('bill-order-id').value;
                if (orderId) {
                    printBill(orderId, 'customer');
                } else {
                    showNotification('Please enter an order ID', 'warning');
                }
            });
            
            document.getElementById('print-admin-bill').addEventListener('click', () => {
                const orderId = document.getElementById('bill-order-id').value;
                if (orderId) {
                    printBill(orderId, 'admin');
                } else {
                    showNotification('Please enter an order ID', 'warning');
                }
            });
            
            document.getElementById('find-order').addEventListener('click', () => {
                updateOrderPreview();
            });
            
            document.getElementById('bill-order-id').addEventListener('input', () => {
                updateOrderPreview();
            });
            
            document.getElementById('order-search').addEventListener('input', () => {
                // Implement search functionality for orders table
                const searchTerm = document.getElementById('order-search').value.toLowerCase();
                const rows = document.querySelectorAll('#all-orders-table tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            document.getElementById('clear-order-search').addEventListener('click', () => {
                document.getElementById('order-search').value = '';
                const rows = document.querySelectorAll('#all-orders-table tr');
                rows.forEach(row => row.style.display = '');
            });
            
            // Settings
            document.getElementById('restaurant-info-form').addEventListener('submit', (e) => {
                e.preventDefault();
                saveRestaurantInfo();
            });
            
            document.getElementById('system-settings-form').addEventListener('submit', (e) => {
                e.preventDefault();
                saveSystemSettings();
            });
            
            document.getElementById('reset-data').addEventListener('click', resetData);
        });

        // Initialize with some sample data if empty
        if (!localStorage.getItem('restaurantData')) {
            restaurantData.categories = ['Starters', 'Main Course', 'Desserts', 'Beverages', 'Specials'];
            
            restaurantData.menuItems = [
                { id: 'ITEM-1', name: 'Vegetable Soup', price: 120, category: 'Starters', description: 'Fresh seasonal vegetables in a light broth', available: true },
                { id: 'ITEM-2', name: 'Chicken Wings', price: 180, category: 'Starters', description: 'Crispy fried wings with spicy sauce', available: true },
                { id: 'ITEM-3', name: 'Paneer Tikka', price: 150, category: 'Starters', description: 'Grilled cottage cheese with Indian spices', available: true },
                { id: 'ITEM-4', name: 'Butter Chicken', price: 250, category: 'Main Course', description: 'Tandoori chicken in a rich tomato cream sauce', available: true },
                { id: 'ITEM-5', name: 'Dal Makhani', price: 180, category: 'Main Course', description: 'Black lentils simmered with butter and cream', available: true },
                { id: 'ITEM-6', name: 'Vegetable Biryani', price: 200, category: 'Main Course', description: 'Fragrant basmati rice with mixed vegetables', available: true },
                { id: 'ITEM-7', name: 'Ice Cream', price: 80, category: 'Desserts', description: 'Vanilla, chocolate or strawberry', available: true },
                { id: 'ITEM-8', name: 'Gulab Jamun', price: 60, category: 'Desserts', description: 'Soft milk balls in sugar syrup', available: true },
                { id: 'ITEM-9', name: 'Cold Coffee', price: 90, category: 'Beverages', description: 'Iced coffee with milk and sugar', available: true },
                { id: 'ITEM-10', name: 'Fresh Lime Soda', price: 50, category: 'Beverages', description: 'Refreshing lime drink with soda', available: true },
                { id: 'ITEM-11', name: 'Chef Special Curry', price: 280, category: 'Specials', description: 'Today special curry with seasonal ingredients', available: true }
            ];
            
            // Initialize tables
            for (let i = 1; i <= 12; i++) {
                const capacity = i <= 4 ? 2 : i <= 8 ? 4 : i <= 10 ? 6 : 8;
                const location = i <= 4 ? 'terrace' : i <= 8 ? 'main' : i <= 10 ? 'private' : 'bar';
                
                restaurantData.tables.push({
                    number: i,
                    status: 'available',
                    capacity: capacity,
                    location: location,
                    orderId: null
                });
            }
            
            // Set kitchen categories
            restaurantData.settings.kitchenSettings.categories = ['Starters', 'Main Course', 'Desserts'];
            
            // Save initial data
            saveData();
            
            // Set default active section
            localStorage.setItem('activeSection', 'dashboard');
        }
    </script>
</body>
</html>
